2018-07-19 23:14:10.934 +07:00 [INF] Migrating database associated with context PersistedGrantDbContext
2018-07-19 23:14:23.597 +07:00 [INF] Migrated database associated with context PersistedGrantDbContext
2018-07-19 23:14:23.607 +07:00 [INF] Migrating database associated with context ApplicationDbContext
2018-07-19 23:14:24.388 +07:00 [INF] Migrated database associated with context ApplicationDbContext
2018-07-19 23:14:24.394 +07:00 [INF] Migrating database associated with context ConfigurationDbContext
2018-07-19 23:14:30.726 +07:00 [INF] Migrated database associated with context ConfigurationDbContext
2018-07-19 23:14:31.175 +07:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-19 23:14:31.177 +07:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-19 23:14:31.178 +07:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-19 23:14:31.178 +07:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-19 23:14:31.178 +07:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-19 23:14:31.515 +07:00 [DBG] Starting token cleanup
2018-07-19 23:15:29.524 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-19 23:15:29.561 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-19 23:15:29.561 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-19 23:15:29.567 +07:00 [DBG] Start authorize request
2018-07-19 23:15:29.585 +07:00 [DBG] No user present in authorize request
2018-07-19 23:15:29.594 +07:00 [DBG] Start authorize request protocol validation
2018-07-19 23:15:29.964 +07:00 [DBG] js found in database: true
2018-07-19 23:15:30.101 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:15:30.439 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-19 23:15:30.462 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:15:30.549 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-19 23:15:30.561 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-19 23:15:30.596 +07:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "AllowedRedirectUris": [
    "http://localhost:4200/"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile blue_api",
  "State": "15320169294330.3549662134086953",
  "Nonce": "N0.81635684364381711532016929433",
  "Raw": {
    "response_type": "id_token token",
    "client_id": "js",
    "redirect_uri": "http://localhost:4200/",
    "scope": "openid profile blue_api",
    "nonce": "N0.81635684364381711532016929433",
    "state": "15320169294330.3549662134086953"
  }
}
2018-07-19 23:15:30.605 +07:00 [INF] Showing login: User is not authenticated
2018-07-19 23:15:41.224 +07:00 [DBG] Start authorize request protocol validation
2018-07-19 23:15:41.260 +07:00 [DBG] js found in database: true
2018-07-19 23:15:41.268 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:15:41.345 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-19 23:15:41.348 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:15:41.354 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-19 23:15:41.354 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-19 23:15:41.364 +07:00 [DBG] js found in database: true
2018-07-19 23:15:59.300 +07:00 [DBG] Augmenting SignInContext
2018-07-19 23:15:59.304 +07:00 [DBG] Adding idp claim with value: local
2018-07-19 23:15:59.304 +07:00 [DBG] Adding amr claim with value: pwd
2018-07-19 23:15:59.305 +07:00 [DBG] Adding auth_time claim with value: 1532016959
2018-07-19 23:15:59.327 +07:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-07-19 23:16:03.876 +07:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-07-19 23:16:03.878 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-07-19 23:16:03.878 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-07-19 23:16:03.886 +07:00 [DBG] Start authorize callback request
2018-07-19 23:16:03.892 +07:00 [DBG] User in authorize request: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-19 23:16:03.893 +07:00 [DBG] Start authorize request protocol validation
2018-07-19 23:16:04.295 +07:00 [DBG] js found in database: true
2018-07-19 23:16:04.302 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:16:04.387 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-19 23:16:04.393 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:16:04.462 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-19 23:16:04.462 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-19 23:16:04.463 +07:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "AllowedRedirectUris": [
    "http://localhost:4200/"
  ],
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile blue_api",
  "State": "15320169294330.3549662134086953",
  "Nonce": "N0.81635684364381711532016929433",
  "SessionId": "0dd5d4a303b2989e176552b721dcc3d8",
  "Raw": {
    "response_type": "id_token token",
    "client_id": "js",
    "redirect_uri": "http://localhost:4200/",
    "scope": "openid profile blue_api",
    "nonce": "N0.81635684364381711532016929433",
    "state": "15320169294330.3549662134086953"
  }
}
2018-07-19 23:16:04.551 +07:00 [DBG] Client is configured to not require consent, no consent is required
2018-07-19 23:16:04.560 +07:00 [DBG] Creating Implicit Flow response.
2018-07-19 23:16:04.572 +07:00 [DBG] Getting claims for access token for client: js
2018-07-19 23:16:04.573 +07:00 [DBG] Getting claims for access token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-19 23:16:04.629 +07:00 [DBG] Claim types from profile service that were filtered: ["jti","iat"]
2018-07-19 23:16:04.746 +07:00 [DBG] Getting claims for identity token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011 and client: js
2018-07-19 23:16:04.747 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-19 23:16:04.805 +07:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "Endpoint": "Authorize",
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "Scopes": "openid profile blue_api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****hL9Q"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****rGfA"
    }
  ],
  "ActivityId": "0HLFDIAR0MT26:00000006",
  "TimeStamp": "2018-07-19T16:16:04Z",
  "ProcessId": 9912,
  "LocalIpAddress": "127.0.0.1:25121",
  "RemoteIpAddress": "::1"
}
2018-07-19 23:16:04.816 +07:00 [INF] Authorize endpoint response
{
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ClientId": "js",
  "RedirectUri": "http://localhost:4200/",
  "State": "15320169294330.3549662134086953",
  "Scope": "openid profile blue_api"
}
2018-07-19 23:16:04.853 +07:00 [DBG] Augmenting SignInContext
2018-07-19 23:16:04.854 +07:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-07-19 23:16:07.769 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-19 23:16:07.803 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-19 23:16:07.803 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-19 23:16:08.266 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-19 23:16:08.271 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-19 23:16:08.271 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-19 23:16:08.271 +07:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-07-19 23:16:08.274 +07:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-07-19 23:16:08.274 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-07-19 23:16:08.283 +07:00 [DBG] Start userinfo request
2018-07-19 23:16:08.287 +07:00 [DBG] Bearer token found in header
2018-07-19 23:16:08.532 +07:00 [DBG] js found in database: true
2018-07-19 23:16:08.581 +07:00 [DBG] js found in database: true
2018-07-19 23:16:09.048 +07:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-07-19 23:16:09.067 +07:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1532016964,
    "exp": 1532020564,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "blue_api"
    ],
    "client_id": "js",
    "sub": "4b33da58-3ce8-4985-81e6-3360508a7011",
    "auth_time": 1532016959,
    "idp": "local",
    "given_name": "Shop",
    "family_name": "Administrator",
    "updated_at": "1532011106",
    "email": "admin@gmail.com",
    "scope": [
      "openid",
      "profile",
      "blue_api"
    ],
    "amr": "pwd"
  }
}
2018-07-19 23:16:09.085 +07:00 [DBG] Creating userinfo response
2018-07-19 23:16:09.089 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:16:09.095 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:16:09.107 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:16:09.108 +07:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture preferred_username nickname middle_name given_name family_name name profile
2018-07-19 23:16:09.108 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:16:09.114 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:16:09.131 +07:00 [INF] Profile service returned to the following claim types: sub preferred_username name given_name family_name updated_at email jti iat
2018-07-19 23:16:09.134 +07:00 [DBG] End userinfo request
2018-07-19 23:20:17.058 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-19 23:20:17.076 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-19 23:20:17.076 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-19 23:20:17.077 +07:00 [DBG] Start authorize request
2018-07-19 23:20:17.087 +07:00 [DBG] User in authorize request: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-19 23:20:17.087 +07:00 [DBG] Start authorize request protocol validation
2018-07-19 23:20:17.362 +07:00 [DBG] js found in database: true
2018-07-19 23:20:17.391 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:20:17.509 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-19 23:20:17.511 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:20:17.516 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-19 23:20:17.516 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-19 23:20:17.522 +07:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "AllowedRedirectUris": [
    "http://localhost:4200/"
  ],
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile blue_api",
  "State": "15320172169000.05156564337974823",
  "Nonce": "N0.007956941605525181532017216900",
  "SessionId": "0dd5d4a303b2989e176552b721dcc3d8",
  "Raw": {
    "response_type": "id_token token",
    "client_id": "js",
    "redirect_uri": "http://localhost:4200/",
    "scope": "openid profile blue_api",
    "nonce": "N0.007956941605525181532017216900",
    "state": "15320172169000.05156564337974823"
  }
}
2018-07-19 23:20:17.629 +07:00 [DBG] Client is configured to not require consent, no consent is required
2018-07-19 23:20:17.630 +07:00 [DBG] Creating Implicit Flow response.
2018-07-19 23:20:17.630 +07:00 [DBG] Getting claims for access token for client: js
2018-07-19 23:20:17.630 +07:00 [DBG] Getting claims for access token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-19 23:20:17.672 +07:00 [DBG] Claim types from profile service that were filtered: ["jti","iat"]
2018-07-19 23:20:17.687 +07:00 [DBG] Getting claims for identity token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011 and client: js
2018-07-19 23:20:17.687 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-19 23:20:17.697 +07:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "Endpoint": "Authorize",
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "Scopes": "openid profile blue_api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****Un0w"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****SrHg"
    }
  ],
  "ActivityId": "0HLFDIAR0MT27:00000001",
  "TimeStamp": "2018-07-19T16:20:17Z",
  "ProcessId": 9912,
  "LocalIpAddress": "127.0.0.1:25121",
  "RemoteIpAddress": "::1"
}
2018-07-19 23:20:17.698 +07:00 [INF] Authorize endpoint response
{
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ClientId": "js",
  "RedirectUri": "http://localhost:4200/",
  "State": "15320172169000.05156564337974823",
  "Scope": "openid profile blue_api"
}
2018-07-19 23:20:20.616 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-19 23:20:20.637 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-19 23:20:20.637 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-19 23:20:21.239 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-19 23:20:21.244 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-19 23:20:21.244 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-19 23:20:21.244 +07:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-07-19 23:20:21.245 +07:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-07-19 23:20:21.245 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-07-19 23:20:21.246 +07:00 [DBG] Start userinfo request
2018-07-19 23:20:21.246 +07:00 [DBG] Bearer token found in header
2018-07-19 23:20:21.358 +07:00 [DBG] js found in database: true
2018-07-19 23:20:21.374 +07:00 [DBG] js found in database: true
2018-07-19 23:20:21.391 +07:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-07-19 23:20:21.392 +07:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1532017217,
    "exp": 1532020817,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "blue_api"
    ],
    "client_id": "js",
    "sub": "4b33da58-3ce8-4985-81e6-3360508a7011",
    "auth_time": 1532016959,
    "idp": "local",
    "given_name": "Shop",
    "family_name": "Administrator",
    "updated_at": "1532011106",
    "email": "admin@gmail.com",
    "scope": [
      "openid",
      "profile",
      "blue_api"
    ],
    "amr": "pwd"
  }
}
2018-07-19 23:20:21.392 +07:00 [DBG] Creating userinfo response
2018-07-19 23:20:21.392 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:20:21.392 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:20:21.415 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:20:21.415 +07:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture preferred_username nickname middle_name given_name family_name name profile
2018-07-19 23:20:21.415 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:20:21.461 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:20:21.571 +07:00 [INF] Profile service returned to the following claim types: sub preferred_username name given_name family_name updated_at email jti iat
2018-07-19 23:20:21.571 +07:00 [DBG] End userinfo request
2018-07-19 23:20:36.886 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-19 23:20:36.890 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-19 23:20:36.890 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-19 23:20:36.890 +07:00 [DBG] Start authorize request
2018-07-19 23:20:36.891 +07:00 [DBG] User in authorize request: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-19 23:20:36.891 +07:00 [DBG] Start authorize request protocol validation
2018-07-19 23:20:36.938 +07:00 [DBG] js found in database: true
2018-07-19 23:20:36.951 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:20:37.028 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-19 23:20:37.031 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:20:37.036 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-19 23:20:37.036 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-19 23:20:37.036 +07:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "AllowedRedirectUris": [
    "http://localhost:4200/"
  ],
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile blue_api",
  "State": "15320172335140.3067245465343631",
  "Nonce": "N0.303236457429337141532017233514",
  "SessionId": "0dd5d4a303b2989e176552b721dcc3d8",
  "Raw": {
    "response_type": "id_token token",
    "client_id": "js",
    "redirect_uri": "http://localhost:4200/",
    "scope": "openid profile blue_api",
    "nonce": "N0.303236457429337141532017233514",
    "state": "15320172335140.3067245465343631"
  }
}
2018-07-19 23:20:37.047 +07:00 [DBG] Client is configured to not require consent, no consent is required
2018-07-19 23:20:37.047 +07:00 [DBG] Creating Implicit Flow response.
2018-07-19 23:20:37.047 +07:00 [DBG] Getting claims for access token for client: js
2018-07-19 23:20:37.047 +07:00 [DBG] Getting claims for access token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-19 23:20:37.062 +07:00 [DBG] Claim types from profile service that were filtered: ["jti","iat"]
2018-07-19 23:20:37.067 +07:00 [DBG] Getting claims for identity token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011 and client: js
2018-07-19 23:20:37.068 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-19 23:20:37.072 +07:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "Endpoint": "Authorize",
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "Scopes": "openid profile blue_api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****WKBA"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****fPKQ"
    }
  ],
  "ActivityId": "0HLFDIAR0MT27:00000004",
  "TimeStamp": "2018-07-19T16:20:37Z",
  "ProcessId": 9912,
  "LocalIpAddress": "127.0.0.1:25121",
  "RemoteIpAddress": "::1"
}
2018-07-19 23:20:37.149 +07:00 [INF] Authorize endpoint response
{
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ClientId": "js",
  "RedirectUri": "http://localhost:4200/",
  "State": "15320172335140.3067245465343631",
  "Scope": "openid profile blue_api"
}
2018-07-19 23:20:40.509 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-19 23:20:40.531 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-19 23:20:40.531 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-19 23:20:41.218 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-19 23:20:41.230 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-19 23:20:41.231 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-19 23:20:41.231 +07:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-07-19 23:20:41.232 +07:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-07-19 23:20:41.232 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-07-19 23:20:41.232 +07:00 [DBG] Start userinfo request
2018-07-19 23:20:41.232 +07:00 [DBG] Bearer token found in header
2018-07-19 23:20:41.410 +07:00 [DBG] js found in database: true
2018-07-19 23:20:41.839 +07:00 [DBG] js found in database: true
2018-07-19 23:20:41.852 +07:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-07-19 23:20:41.852 +07:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1532017237,
    "exp": 1532020837,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "blue_api"
    ],
    "client_id": "js",
    "sub": "4b33da58-3ce8-4985-81e6-3360508a7011",
    "auth_time": 1532016959,
    "idp": "local",
    "given_name": "Shop",
    "family_name": "Administrator",
    "updated_at": "1532011106",
    "email": "admin@gmail.com",
    "scope": [
      "openid",
      "profile",
      "blue_api"
    ],
    "amr": "pwd"
  }
}
2018-07-19 23:20:41.853 +07:00 [DBG] Creating userinfo response
2018-07-19 23:20:41.853 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:20:41.853 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:20:41.953 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:20:41.954 +07:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture preferred_username nickname middle_name given_name family_name name profile
2018-07-19 23:20:41.955 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:20:41.996 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:20:42.048 +07:00 [INF] Profile service returned to the following claim types: sub preferred_username name given_name family_name updated_at email jti iat
2018-07-19 23:20:42.048 +07:00 [DBG] End userinfo request
2018-07-19 23:21:13.508 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-19 23:21:13.510 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-19 23:21:13.510 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-19 23:21:13.510 +07:00 [DBG] Start authorize request
2018-07-19 23:21:13.510 +07:00 [DBG] User in authorize request: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-19 23:21:13.510 +07:00 [DBG] Start authorize request protocol validation
2018-07-19 23:21:13.567 +07:00 [DBG] js found in database: true
2018-07-19 23:21:13.579 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:21:13.656 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-19 23:21:13.664 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:21:13.668 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-19 23:21:13.668 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-19 23:21:13.669 +07:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "AllowedRedirectUris": [
    "http://localhost:4200/"
  ],
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile blue_api",
  "State": "15320172709650.5026887513613907",
  "Nonce": "N0.45590642037654881532017270965",
  "SessionId": "0dd5d4a303b2989e176552b721dcc3d8",
  "Raw": {
    "response_type": "id_token token",
    "client_id": "js",
    "redirect_uri": "http://localhost:4200/",
    "scope": "openid profile blue_api",
    "nonce": "N0.45590642037654881532017270965",
    "state": "15320172709650.5026887513613907"
  }
}
2018-07-19 23:21:13.681 +07:00 [DBG] Client is configured to not require consent, no consent is required
2018-07-19 23:21:13.681 +07:00 [DBG] Creating Implicit Flow response.
2018-07-19 23:21:13.681 +07:00 [DBG] Getting claims for access token for client: js
2018-07-19 23:21:13.682 +07:00 [DBG] Getting claims for access token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-19 23:21:13.695 +07:00 [DBG] Claim types from profile service that were filtered: ["jti","iat"]
2018-07-19 23:21:13.698 +07:00 [DBG] Getting claims for identity token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011 and client: js
2018-07-19 23:21:13.698 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-19 23:21:13.702 +07:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "Endpoint": "Authorize",
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "Scopes": "openid profile blue_api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****_jkg"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****mWUQ"
    }
  ],
  "ActivityId": "0HLFDIAR0MT27:00000007",
  "TimeStamp": "2018-07-19T16:21:13Z",
  "ProcessId": 9912,
  "LocalIpAddress": "127.0.0.1:25121",
  "RemoteIpAddress": "::1"
}
2018-07-19 23:21:13.703 +07:00 [INF] Authorize endpoint response
{
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ClientId": "js",
  "RedirectUri": "http://localhost:4200/",
  "State": "15320172709650.5026887513613907",
  "Scope": "openid profile blue_api"
}
2018-07-19 23:21:17.039 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-19 23:21:17.044 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-19 23:21:17.045 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-19 23:21:17.768 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-19 23:21:17.772 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-19 23:21:17.772 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-19 23:21:17.773 +07:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-07-19 23:21:17.774 +07:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-07-19 23:21:17.774 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-07-19 23:21:17.774 +07:00 [DBG] Start userinfo request
2018-07-19 23:21:17.774 +07:00 [DBG] Bearer token found in header
2018-07-19 23:21:17.842 +07:00 [DBG] js found in database: true
2018-07-19 23:21:17.852 +07:00 [DBG] js found in database: true
2018-07-19 23:21:18.619 +07:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-07-19 23:21:18.619 +07:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1532017273,
    "exp": 1532020873,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "blue_api"
    ],
    "client_id": "js",
    "sub": "4b33da58-3ce8-4985-81e6-3360508a7011",
    "auth_time": 1532016959,
    "idp": "local",
    "given_name": "Shop",
    "family_name": "Administrator",
    "updated_at": "1532011106",
    "email": "admin@gmail.com",
    "scope": [
      "openid",
      "profile",
      "blue_api"
    ],
    "amr": "pwd"
  }
}
2018-07-19 23:21:18.619 +07:00 [DBG] Creating userinfo response
2018-07-19 23:21:18.619 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:21:18.619 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:21:18.670 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:21:18.670 +07:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture preferred_username nickname middle_name given_name family_name name profile
2018-07-19 23:21:18.671 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:21:18.677 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:21:18.731 +07:00 [INF] Profile service returned to the following claim types: sub preferred_username name given_name family_name updated_at email jti iat
2018-07-19 23:21:18.732 +07:00 [DBG] End userinfo request
2018-07-19 23:21:40.517 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-19 23:21:40.517 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-19 23:21:40.517 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-19 23:21:40.517 +07:00 [DBG] Start authorize request
2018-07-19 23:21:40.518 +07:00 [DBG] User in authorize request: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-19 23:21:40.518 +07:00 [DBG] Start authorize request protocol validation
2018-07-19 23:21:40.558 +07:00 [DBG] js found in database: true
2018-07-19 23:21:40.564 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:21:40.652 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-19 23:21:40.655 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:21:40.659 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-19 23:21:40.659 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-19 23:21:40.659 +07:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "AllowedRedirectUris": [
    "http://localhost:4200/"
  ],
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile blue_api",
  "State": "15320172942430.5013376460957744",
  "Nonce": "N0.072079746101833651532017294243",
  "SessionId": "0dd5d4a303b2989e176552b721dcc3d8",
  "Raw": {
    "response_type": "id_token token",
    "client_id": "js",
    "redirect_uri": "http://localhost:4200/",
    "scope": "openid profile blue_api",
    "nonce": "N0.072079746101833651532017294243",
    "state": "15320172942430.5013376460957744"
  }
}
2018-07-19 23:21:40.668 +07:00 [DBG] Client is configured to not require consent, no consent is required
2018-07-19 23:21:40.668 +07:00 [DBG] Creating Implicit Flow response.
2018-07-19 23:21:40.668 +07:00 [DBG] Getting claims for access token for client: js
2018-07-19 23:21:40.668 +07:00 [DBG] Getting claims for access token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-19 23:21:40.692 +07:00 [DBG] Claim types from profile service that were filtered: ["jti","iat"]
2018-07-19 23:21:40.696 +07:00 [DBG] Getting claims for identity token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011 and client: js
2018-07-19 23:21:40.696 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-19 23:21:40.704 +07:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "Endpoint": "Authorize",
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "Scopes": "openid profile blue_api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****PMVQ"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****oKHQ"
    }
  ],
  "ActivityId": "0HLFDIAR0MT27:0000000A",
  "TimeStamp": "2018-07-19T16:21:40Z",
  "ProcessId": 9912,
  "LocalIpAddress": "127.0.0.1:25121",
  "RemoteIpAddress": "::1"
}
2018-07-19 23:21:40.704 +07:00 [INF] Authorize endpoint response
{
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ClientId": "js",
  "RedirectUri": "http://localhost:4200/",
  "State": "15320172942430.5013376460957744",
  "Scope": "openid profile blue_api"
}
2018-07-19 23:21:43.842 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-19 23:21:43.860 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-19 23:21:43.860 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-19 23:21:44.643 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-19 23:21:44.648 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-19 23:21:44.649 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-19 23:21:44.649 +07:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-07-19 23:21:44.649 +07:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-07-19 23:21:44.649 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-07-19 23:21:44.649 +07:00 [DBG] Start userinfo request
2018-07-19 23:21:44.649 +07:00 [DBG] Bearer token found in header
2018-07-19 23:21:44.705 +07:00 [DBG] js found in database: true
2018-07-19 23:21:44.908 +07:00 [DBG] js found in database: true
2018-07-19 23:21:44.935 +07:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-07-19 23:21:44.936 +07:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1532017300,
    "exp": 1532020900,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "blue_api"
    ],
    "client_id": "js",
    "sub": "4b33da58-3ce8-4985-81e6-3360508a7011",
    "auth_time": 1532016959,
    "idp": "local",
    "given_name": "Shop",
    "family_name": "Administrator",
    "updated_at": "1532011106",
    "email": "admin@gmail.com",
    "scope": [
      "openid",
      "profile",
      "blue_api"
    ],
    "amr": "pwd"
  }
}
2018-07-19 23:21:44.936 +07:00 [DBG] Creating userinfo response
2018-07-19 23:21:44.936 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:21:44.936 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:21:44.943 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:21:44.943 +07:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture preferred_username nickname middle_name given_name family_name name profile
2018-07-19 23:21:44.943 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:21:44.945 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:21:44.975 +07:00 [INF] Profile service returned to the following claim types: sub preferred_username name given_name family_name updated_at email jti iat
2018-07-19 23:21:44.976 +07:00 [DBG] End userinfo request
2018-07-19 23:23:40.761 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-19 23:23:40.762 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-19 23:23:40.762 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-19 23:23:40.762 +07:00 [DBG] Start authorize request
2018-07-19 23:23:40.762 +07:00 [DBG] User in authorize request: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-19 23:23:40.762 +07:00 [DBG] Start authorize request protocol validation
2018-07-19 23:23:40.817 +07:00 [DBG] js found in database: true
2018-07-19 23:23:40.827 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:23:40.903 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-19 23:23:40.909 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:23:40.982 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-19 23:23:40.982 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-19 23:23:40.983 +07:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "AllowedRedirectUris": [
    "http://localhost:4200/"
  ],
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile blue_api",
  "State": "15320174176430.3343703226677228",
  "Nonce": "N0.51648757092476051532017417643",
  "SessionId": "0dd5d4a303b2989e176552b721dcc3d8",
  "Raw": {
    "response_type": "id_token token",
    "client_id": "js",
    "redirect_uri": "http://localhost:4200/",
    "scope": "openid profile blue_api",
    "nonce": "N0.51648757092476051532017417643",
    "state": "15320174176430.3343703226677228"
  }
}
2018-07-19 23:23:40.989 +07:00 [DBG] Client is configured to not require consent, no consent is required
2018-07-19 23:23:40.990 +07:00 [DBG] Creating Implicit Flow response.
2018-07-19 23:23:40.990 +07:00 [DBG] Getting claims for access token for client: js
2018-07-19 23:23:40.990 +07:00 [DBG] Getting claims for access token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-19 23:23:41.005 +07:00 [DBG] Claim types from profile service that were filtered: ["jti","iat"]
2018-07-19 23:23:41.009 +07:00 [DBG] Getting claims for identity token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011 and client: js
2018-07-19 23:23:41.009 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-19 23:23:41.011 +07:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "Endpoint": "Authorize",
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "Scopes": "openid profile blue_api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****2_jg"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****Tobw"
    }
  ],
  "ActivityId": "0HLFDIAR0MT28:00000001",
  "TimeStamp": "2018-07-19T16:23:41Z",
  "ProcessId": 9912,
  "LocalIpAddress": "127.0.0.1:25121",
  "RemoteIpAddress": "::1"
}
2018-07-19 23:23:41.012 +07:00 [INF] Authorize endpoint response
{
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ClientId": "js",
  "RedirectUri": "http://localhost:4200/",
  "State": "15320174176430.3343703226677228",
  "Scope": "openid profile blue_api"
}
2018-07-19 23:25:19.129 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-19 23:25:19.142 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-19 23:25:19.142 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-19 23:25:24.899 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-19 23:25:24.904 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-19 23:25:24.904 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-19 23:25:24.904 +07:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-07-19 23:25:24.905 +07:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-07-19 23:25:24.905 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-07-19 23:25:24.905 +07:00 [DBG] Start userinfo request
2018-07-19 23:25:24.905 +07:00 [DBG] Bearer token found in header
2018-07-19 23:25:24.963 +07:00 [DBG] js found in database: true
2018-07-19 23:25:24.976 +07:00 [DBG] js found in database: true
2018-07-19 23:25:25.055 +07:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-07-19 23:25:25.055 +07:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1532017421,
    "exp": 1532021021,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "blue_api"
    ],
    "client_id": "js",
    "sub": "4b33da58-3ce8-4985-81e6-3360508a7011",
    "auth_time": 1532016959,
    "idp": "local",
    "given_name": "Shop",
    "family_name": "Administrator",
    "updated_at": "1532011106",
    "email": "admin@gmail.com",
    "scope": [
      "openid",
      "profile",
      "blue_api"
    ],
    "amr": "pwd"
  }
}
2018-07-19 23:25:25.100 +07:00 [DBG] Creating userinfo response
2018-07-19 23:25:25.100 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:25:25.101 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:25:25.111 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:25:25.112 +07:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture preferred_username nickname middle_name given_name family_name name profile
2018-07-19 23:25:25.112 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:25:25.114 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:25:25.130 +07:00 [INF] Profile service returned to the following claim types: sub preferred_username name given_name family_name updated_at email jti iat
2018-07-19 23:25:25.130 +07:00 [DBG] End userinfo request
2018-07-19 23:32:49.897 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-19 23:32:49.911 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-19 23:32:49.912 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-19 23:32:49.912 +07:00 [DBG] Start authorize request
2018-07-19 23:32:49.916 +07:00 [DBG] User in authorize request: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-19 23:32:49.916 +07:00 [DBG] Start authorize request protocol validation
2018-07-19 23:32:50.159 +07:00 [DBG] js found in database: true
2018-07-19 23:32:50.179 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:32:50.268 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-19 23:32:50.270 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:32:50.276 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-19 23:32:50.277 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-19 23:32:50.283 +07:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "AllowedRedirectUris": [
    "http://localhost:4200/"
  ],
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile blue_api",
  "State": "15320179666130.6585870901731952",
  "Nonce": "N0.9990051757448591532017966613",
  "SessionId": "0dd5d4a303b2989e176552b721dcc3d8",
  "Raw": {
    "response_type": "id_token token",
    "client_id": "js",
    "redirect_uri": "http://localhost:4200/",
    "scope": "openid profile blue_api",
    "nonce": "N0.9990051757448591532017966613",
    "state": "15320179666130.6585870901731952"
  }
}
2018-07-19 23:32:50.386 +07:00 [DBG] Client is configured to not require consent, no consent is required
2018-07-19 23:32:50.386 +07:00 [DBG] Creating Implicit Flow response.
2018-07-19 23:32:50.386 +07:00 [DBG] Getting claims for access token for client: js
2018-07-19 23:32:50.387 +07:00 [DBG] Getting claims for access token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-19 23:32:50.411 +07:00 [DBG] Claim types from profile service that were filtered: ["jti","iat"]
2018-07-19 23:32:50.420 +07:00 [DBG] Getting claims for identity token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011 and client: js
2018-07-19 23:32:50.420 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-19 23:32:50.427 +07:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "Endpoint": "Authorize",
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "Scopes": "openid profile blue_api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****A0Zg"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****mEUA"
    }
  ],
  "ActivityId": "0HLFDIAR0MT2A:00000001",
  "TimeStamp": "2018-07-19T16:32:50Z",
  "ProcessId": 9912,
  "LocalIpAddress": "127.0.0.1:25121",
  "RemoteIpAddress": "::1"
}
2018-07-19 23:32:50.428 +07:00 [INF] Authorize endpoint response
{
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ClientId": "js",
  "RedirectUri": "http://localhost:4200/",
  "State": "15320179666130.6585870901731952",
  "Scope": "openid profile blue_api"
}
2018-07-19 23:32:53.722 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-19 23:32:53.739 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-19 23:32:53.739 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-19 23:32:54.495 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-19 23:32:54.503 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-19 23:32:54.503 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-19 23:32:54.503 +07:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-07-19 23:32:54.506 +07:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-07-19 23:32:54.506 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-07-19 23:32:54.506 +07:00 [DBG] Start userinfo request
2018-07-19 23:32:54.506 +07:00 [DBG] Bearer token found in header
2018-07-19 23:32:54.646 +07:00 [DBG] js found in database: true
2018-07-19 23:32:54.679 +07:00 [DBG] js found in database: true
2018-07-19 23:32:54.696 +07:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-07-19 23:32:54.701 +07:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1532017970,
    "exp": 1532021570,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "blue_api"
    ],
    "client_id": "js",
    "sub": "4b33da58-3ce8-4985-81e6-3360508a7011",
    "auth_time": 1532016959,
    "idp": "local",
    "given_name": "Shop",
    "family_name": "Administrator",
    "updated_at": "1532011106",
    "email": "admin@gmail.com",
    "scope": [
      "openid",
      "profile",
      "blue_api"
    ],
    "amr": "pwd"
  }
}
2018-07-19 23:32:54.702 +07:00 [DBG] Creating userinfo response
2018-07-19 23:32:54.702 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:32:54.703 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:32:54.744 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:32:54.745 +07:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture preferred_username nickname middle_name given_name family_name name profile
2018-07-19 23:32:54.745 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:32:54.762 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:32:54.776 +07:00 [INF] Profile service returned to the following claim types: sub preferred_username name given_name family_name updated_at email jti iat
2018-07-19 23:32:54.776 +07:00 [DBG] End userinfo request
2018-07-19 23:38:35.737 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-19 23:38:35.744 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-19 23:38:35.744 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-19 23:38:35.745 +07:00 [DBG] Start authorize request
2018-07-19 23:38:35.749 +07:00 [DBG] User in authorize request: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-19 23:38:35.750 +07:00 [DBG] Start authorize request protocol validation
2018-07-19 23:38:35.947 +07:00 [DBG] js found in database: true
2018-07-19 23:38:35.971 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:38:36.080 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-19 23:38:36.083 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:38:36.092 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-19 23:38:36.092 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-19 23:38:36.094 +07:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "AllowedRedirectUris": [
    "http://localhost:4200/"
  ],
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile blue_api",
  "State": "15320183133000.9052818463654118",
  "Nonce": "N0.80656069715226191532018313300",
  "SessionId": "0dd5d4a303b2989e176552b721dcc3d8",
  "Raw": {
    "response_type": "id_token token",
    "client_id": "js",
    "redirect_uri": "http://localhost:4200/",
    "scope": "openid profile blue_api",
    "nonce": "N0.80656069715226191532018313300",
    "state": "15320183133000.9052818463654118"
  }
}
2018-07-19 23:38:36.145 +07:00 [DBG] Client is configured to not require consent, no consent is required
2018-07-19 23:38:36.145 +07:00 [DBG] Creating Implicit Flow response.
2018-07-19 23:38:36.145 +07:00 [DBG] Getting claims for access token for client: js
2018-07-19 23:38:36.146 +07:00 [DBG] Getting claims for access token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-19 23:38:36.169 +07:00 [DBG] Claim types from profile service that were filtered: ["jti","iat"]
2018-07-19 23:38:36.179 +07:00 [DBG] Getting claims for identity token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011 and client: js
2018-07-19 23:38:36.179 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-19 23:38:36.186 +07:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "Endpoint": "Authorize",
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "Scopes": "openid profile blue_api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****AZdA"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****v91A"
    }
  ],
  "ActivityId": "0HLFDIAR0MT2B:00000001",
  "TimeStamp": "2018-07-19T16:38:36Z",
  "ProcessId": 9912,
  "LocalIpAddress": "127.0.0.1:25121",
  "RemoteIpAddress": "::1"
}
2018-07-19 23:38:36.186 +07:00 [INF] Authorize endpoint response
{
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ClientId": "js",
  "RedirectUri": "http://localhost:4200/",
  "State": "15320183133000.9052818463654118",
  "Scope": "openid profile blue_api"
}
2018-07-19 23:38:39.055 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-19 23:38:39.089 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-19 23:38:39.090 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-19 23:38:39.718 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-19 23:38:39.720 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-19 23:38:39.720 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-19 23:38:39.720 +07:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-07-19 23:38:39.721 +07:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-07-19 23:38:39.721 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-07-19 23:38:39.721 +07:00 [DBG] Start userinfo request
2018-07-19 23:38:39.721 +07:00 [DBG] Bearer token found in header
2018-07-19 23:38:39.752 +07:00 [DBG] js found in database: true
2018-07-19 23:38:39.784 +07:00 [DBG] js found in database: true
2018-07-19 23:38:39.821 +07:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-07-19 23:38:39.822 +07:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1532018316,
    "exp": 1532021916,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "blue_api"
    ],
    "client_id": "js",
    "sub": "4b33da58-3ce8-4985-81e6-3360508a7011",
    "auth_time": 1532016959,
    "idp": "local",
    "given_name": "Shop",
    "family_name": "Administrator",
    "updated_at": "1532011106",
    "email": "admin@gmail.com",
    "scope": [
      "openid",
      "profile",
      "blue_api"
    ],
    "amr": "pwd"
  }
}
2018-07-19 23:38:39.823 +07:00 [DBG] Creating userinfo response
2018-07-19 23:38:39.823 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:38:39.823 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:38:39.840 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:38:39.840 +07:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture preferred_username nickname middle_name given_name family_name name profile
2018-07-19 23:38:39.841 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:38:39.845 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:38:39.899 +07:00 [INF] Profile service returned to the following claim types: sub preferred_username name given_name family_name updated_at email jti iat
2018-07-19 23:38:39.899 +07:00 [DBG] End userinfo request
2018-07-19 23:55:56.266 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-19 23:55:56.278 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-19 23:55:56.278 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-19 23:55:56.278 +07:00 [DBG] Start authorize request
2018-07-19 23:55:56.280 +07:00 [DBG] User in authorize request: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-19 23:55:56.280 +07:00 [DBG] Start authorize request protocol validation
2018-07-19 23:55:56.349 +07:00 [DBG] js found in database: true
2018-07-19 23:55:56.364 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:55:56.471 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-19 23:55:56.475 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:55:56.479 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-19 23:55:56.479 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-19 23:55:56.484 +07:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "AllowedRedirectUris": [
    "http://localhost:4200/"
  ],
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile blue_api",
  "State": "15320193553870.1000567404733288",
  "Nonce": "N0.34669560085765051532019355387",
  "SessionId": "0dd5d4a303b2989e176552b721dcc3d8",
  "Raw": {
    "response_type": "id_token token",
    "client_id": "js",
    "redirect_uri": "http://localhost:4200/",
    "scope": "openid profile blue_api",
    "nonce": "N0.34669560085765051532019355387",
    "state": "15320193553870.1000567404733288"
  }
}
2018-07-19 23:55:56.484 +07:00 [DBG] Client is configured to not require consent, no consent is required
2018-07-19 23:55:56.484 +07:00 [DBG] Creating Implicit Flow response.
2018-07-19 23:55:56.484 +07:00 [DBG] Getting claims for access token for client: js
2018-07-19 23:55:56.484 +07:00 [DBG] Getting claims for access token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-19 23:55:56.500 +07:00 [DBG] Claim types from profile service that were filtered: ["jti","iat"]
2018-07-19 23:55:56.515 +07:00 [DBG] Getting claims for identity token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011 and client: js
2018-07-19 23:55:56.515 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-19 23:55:56.521 +07:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "Endpoint": "Authorize",
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "Scopes": "openid profile blue_api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****_qBg"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****uS4g"
    }
  ],
  "ActivityId": "0HLFDIAR0MT2D:00000001",
  "TimeStamp": "2018-07-19T16:55:56Z",
  "ProcessId": 9912,
  "LocalIpAddress": "127.0.0.1:25121",
  "RemoteIpAddress": "::1"
}
2018-07-19 23:55:56.521 +07:00 [INF] Authorize endpoint response
{
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ClientId": "js",
  "RedirectUri": "http://localhost:4200/",
  "State": "15320193553870.1000567404733288",
  "Scope": "openid profile blue_api"
}
2018-07-19 23:55:58.396 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-19 23:55:58.405 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-19 23:55:58.405 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-19 23:55:58.836 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-19 23:55:58.840 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-19 23:55:58.840 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-19 23:55:58.841 +07:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-07-19 23:55:58.846 +07:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-07-19 23:55:58.847 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-07-19 23:55:58.847 +07:00 [DBG] Start userinfo request
2018-07-19 23:55:58.847 +07:00 [DBG] Bearer token found in header
2018-07-19 23:55:58.887 +07:00 [DBG] js found in database: true
2018-07-19 23:55:59.131 +07:00 [DBG] js found in database: true
2018-07-19 23:55:59.240 +07:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-07-19 23:55:59.241 +07:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1532019356,
    "exp": 1532022956,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "blue_api"
    ],
    "client_id": "js",
    "sub": "4b33da58-3ce8-4985-81e6-3360508a7011",
    "auth_time": 1532016959,
    "idp": "local",
    "given_name": "Shop",
    "family_name": "Administrator",
    "updated_at": "1532011106",
    "email": "admin@gmail.com",
    "scope": [
      "openid",
      "profile",
      "blue_api"
    ],
    "amr": "pwd"
  }
}
2018-07-19 23:55:59.241 +07:00 [DBG] Creating userinfo response
2018-07-19 23:55:59.241 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:55:59.241 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:55:59.257 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:55:59.258 +07:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture preferred_username nickname middle_name given_name family_name name profile
2018-07-19 23:55:59.258 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:55:59.267 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:55:59.327 +07:00 [INF] Profile service returned to the following claim types: sub preferred_username name given_name family_name updated_at email jti iat
2018-07-19 23:55:59.327 +07:00 [DBG] End userinfo request
2018-07-19 23:59:03.179 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-19 23:59:03.189 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-19 23:59:03.189 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-19 23:59:03.189 +07:00 [DBG] Start authorize request
2018-07-19 23:59:03.192 +07:00 [DBG] User in authorize request: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-19 23:59:03.193 +07:00 [DBG] Start authorize request protocol validation
2018-07-19 23:59:03.357 +07:00 [DBG] js found in database: true
2018-07-19 23:59:03.373 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:59:03.454 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-19 23:59:03.456 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:59:03.463 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-19 23:59:03.464 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-19 23:59:03.471 +07:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "AllowedRedirectUris": [
    "http://localhost:4200/"
  ],
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile blue_api",
  "State": "15320195430040.36432706037107576",
  "Nonce": "N0.35860624486383011532019543004",
  "SessionId": "0dd5d4a303b2989e176552b721dcc3d8",
  "Raw": {
    "response_type": "id_token token",
    "client_id": "js",
    "redirect_uri": "http://localhost:4200/",
    "scope": "openid profile blue_api",
    "nonce": "N0.35860624486383011532019543004",
    "state": "15320195430040.36432706037107576"
  }
}
2018-07-19 23:59:03.518 +07:00 [DBG] Client is configured to not require consent, no consent is required
2018-07-19 23:59:03.518 +07:00 [DBG] Creating Implicit Flow response.
2018-07-19 23:59:03.518 +07:00 [DBG] Getting claims for access token for client: js
2018-07-19 23:59:03.518 +07:00 [DBG] Getting claims for access token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-19 23:59:03.572 +07:00 [DBG] Claim types from profile service that were filtered: ["jti","iat"]
2018-07-19 23:59:03.580 +07:00 [DBG] Getting claims for identity token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011 and client: js
2018-07-19 23:59:03.580 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-19 23:59:03.588 +07:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "Endpoint": "Authorize",
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "Scopes": "openid profile blue_api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****Rbyg"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****87_A"
    }
  ],
  "ActivityId": "0HLFDIAR0MT2E:00000001",
  "TimeStamp": "2018-07-19T16:59:03Z",
  "ProcessId": 9912,
  "LocalIpAddress": "127.0.0.1:25121",
  "RemoteIpAddress": "::1"
}
2018-07-19 23:59:03.589 +07:00 [INF] Authorize endpoint response
{
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ClientId": "js",
  "RedirectUri": "http://localhost:4200/",
  "State": "15320195430040.36432706037107576",
  "Scope": "openid profile blue_api"
}
2018-07-19 23:59:05.998 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-19 23:59:06.003 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-19 23:59:06.003 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-19 23:59:06.413 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-19 23:59:06.416 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-19 23:59:06.416 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-19 23:59:06.416 +07:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-07-19 23:59:06.417 +07:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-07-19 23:59:06.417 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-07-19 23:59:06.417 +07:00 [DBG] Start userinfo request
2018-07-19 23:59:06.417 +07:00 [DBG] Bearer token found in header
2018-07-19 23:59:06.433 +07:00 [DBG] js found in database: true
2018-07-19 23:59:06.442 +07:00 [DBG] js found in database: true
2018-07-19 23:59:06.449 +07:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-07-19 23:59:06.449 +07:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1532019543,
    "exp": 1532023143,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "blue_api"
    ],
    "client_id": "js",
    "sub": "4b33da58-3ce8-4985-81e6-3360508a7011",
    "auth_time": 1532016959,
    "idp": "local",
    "given_name": "Shop",
    "family_name": "Administrator",
    "updated_at": "1532011106",
    "email": "admin@gmail.com",
    "scope": [
      "openid",
      "profile",
      "blue_api"
    ],
    "amr": "pwd"
  }
}
2018-07-19 23:59:06.449 +07:00 [DBG] Creating userinfo response
2018-07-19 23:59:06.449 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:59:06.449 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:59:06.452 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:59:06.452 +07:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture preferred_username nickname middle_name given_name family_name name profile
2018-07-19 23:59:06.452 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:59:06.455 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:59:06.505 +07:00 [INF] Profile service returned to the following claim types: sub preferred_username name given_name family_name updated_at email jti iat
2018-07-19 23:59:06.505 +07:00 [DBG] End userinfo request
2018-07-19 23:59:35.107 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-19 23:59:35.108 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-19 23:59:35.108 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-19 23:59:35.108 +07:00 [DBG] Start authorize request
2018-07-19 23:59:35.108 +07:00 [DBG] User in authorize request: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-19 23:59:35.108 +07:00 [DBG] Start authorize request protocol validation
2018-07-19 23:59:35.156 +07:00 [DBG] js found in database: true
2018-07-19 23:59:35.168 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:59:35.261 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-19 23:59:35.269 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:59:35.316 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-19 23:59:35.316 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-19 23:59:35.318 +07:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "AllowedRedirectUris": [
    "http://localhost:4200/"
  ],
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile blue_api",
  "State": "15320195750540.8355260794318846",
  "Nonce": "N0.80859143112572941532019575054",
  "SessionId": "0dd5d4a303b2989e176552b721dcc3d8",
  "Raw": {
    "response_type": "id_token token",
    "client_id": "js",
    "redirect_uri": "http://localhost:4200/",
    "scope": "openid profile blue_api",
    "nonce": "N0.80859143112572941532019575054",
    "state": "15320195750540.8355260794318846"
  }
}
2018-07-19 23:59:35.331 +07:00 [DBG] Client is configured to not require consent, no consent is required
2018-07-19 23:59:35.331 +07:00 [DBG] Creating Implicit Flow response.
2018-07-19 23:59:35.331 +07:00 [DBG] Getting claims for access token for client: js
2018-07-19 23:59:35.331 +07:00 [DBG] Getting claims for access token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-19 23:59:35.353 +07:00 [DBG] Claim types from profile service that were filtered: ["jti","iat"]
2018-07-19 23:59:35.358 +07:00 [DBG] Getting claims for identity token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011 and client: js
2018-07-19 23:59:35.359 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-19 23:59:35.364 +07:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "Endpoint": "Authorize",
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "Scopes": "openid profile blue_api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****_q1A"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****8m7g"
    }
  ],
  "ActivityId": "0HLFDIAR0MT2E:00000004",
  "TimeStamp": "2018-07-19T16:59:35Z",
  "ProcessId": 9912,
  "LocalIpAddress": "127.0.0.1:25121",
  "RemoteIpAddress": "::1"
}
2018-07-19 23:59:35.364 +07:00 [INF] Authorize endpoint response
{
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ClientId": "js",
  "RedirectUri": "http://localhost:4200/",
  "State": "15320195750540.8355260794318846",
  "Scope": "openid profile blue_api"
}
2018-07-19 23:59:38.829 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-19 23:59:38.833 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-19 23:59:38.833 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-19 23:59:39.572 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-19 23:59:39.631 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-19 23:59:39.631 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-19 23:59:39.631 +07:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-07-19 23:59:39.636 +07:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-07-19 23:59:39.637 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-07-19 23:59:39.637 +07:00 [DBG] Start userinfo request
2018-07-19 23:59:39.637 +07:00 [DBG] Bearer token found in header
2018-07-19 23:59:40.526 +07:00 [DBG] js found in database: true
2018-07-19 23:59:40.575 +07:00 [DBG] js found in database: true
2018-07-19 23:59:40.600 +07:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-07-19 23:59:40.600 +07:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1532019575,
    "exp": 1532023175,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "blue_api"
    ],
    "client_id": "js",
    "sub": "4b33da58-3ce8-4985-81e6-3360508a7011",
    "auth_time": 1532016959,
    "idp": "local",
    "given_name": "Shop",
    "family_name": "Administrator",
    "updated_at": "1532011106",
    "email": "admin@gmail.com",
    "scope": [
      "openid",
      "profile",
      "blue_api"
    ],
    "amr": "pwd"
  }
}
2018-07-19 23:59:40.600 +07:00 [DBG] Creating userinfo response
2018-07-19 23:59:40.600 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:59:40.601 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:59:40.609 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:59:40.609 +07:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture preferred_username nickname middle_name given_name family_name name profile
2018-07-19 23:59:40.610 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-19 23:59:40.618 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-19 23:59:40.650 +07:00 [INF] Profile service returned to the following claim types: sub preferred_username name given_name family_name updated_at email jti iat
2018-07-19 23:59:40.651 +07:00 [DBG] End userinfo request
2018-07-20 00:00:25.226 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-20 00:00:25.227 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-20 00:00:25.227 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-20 00:00:25.227 +07:00 [DBG] Start authorize request
2018-07-20 00:00:25.227 +07:00 [DBG] User in authorize request: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-20 00:00:25.227 +07:00 [DBG] Start authorize request protocol validation
2018-07-20 00:00:25.276 +07:00 [DBG] js found in database: true
2018-07-20 00:00:25.288 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-20 00:00:25.386 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-20 00:00:25.388 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-20 00:00:25.395 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-20 00:00:25.396 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-20 00:00:25.396 +07:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "AllowedRedirectUris": [
    "http://localhost:4200/"
  ],
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile blue_api",
  "State": "15320196251850.5177732572541762",
  "Nonce": "N0.91854747039873291532019625185",
  "SessionId": "0dd5d4a303b2989e176552b721dcc3d8",
  "Raw": {
    "response_type": "id_token token",
    "client_id": "js",
    "redirect_uri": "http://localhost:4200/",
    "scope": "openid profile blue_api",
    "nonce": "N0.91854747039873291532019625185",
    "state": "15320196251850.5177732572541762"
  }
}
2018-07-20 00:00:25.407 +07:00 [DBG] Client is configured to not require consent, no consent is required
2018-07-20 00:00:25.408 +07:00 [DBG] Creating Implicit Flow response.
2018-07-20 00:00:25.408 +07:00 [DBG] Getting claims for access token for client: js
2018-07-20 00:00:25.408 +07:00 [DBG] Getting claims for access token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-20 00:00:25.430 +07:00 [DBG] Claim types from profile service that were filtered: ["jti","iat"]
2018-07-20 00:00:25.434 +07:00 [DBG] Getting claims for identity token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011 and client: js
2018-07-20 00:00:25.434 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-20 00:00:25.438 +07:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "Endpoint": "Authorize",
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "Scopes": "openid profile blue_api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****f9-g"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****KB5Q"
    }
  ],
  "ActivityId": "0HLFDIAR0MT2E:00000007",
  "TimeStamp": "2018-07-19T17:00:25Z",
  "ProcessId": 9912,
  "LocalIpAddress": "127.0.0.1:25121",
  "RemoteIpAddress": "::1"
}
2018-07-20 00:00:25.438 +07:00 [INF] Authorize endpoint response
{
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ClientId": "js",
  "RedirectUri": "http://localhost:4200/",
  "State": "15320196251850.5177732572541762",
  "Scope": "openid profile blue_api"
}
2018-07-20 00:00:28.825 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-20 00:00:28.919 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-20 00:00:28.920 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-20 00:00:48.388 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-20 00:00:48.407 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-20 00:00:48.408 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-20 00:00:48.414 +07:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-07-20 00:00:48.419 +07:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-07-20 00:00:48.421 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-07-20 00:00:48.421 +07:00 [DBG] Start userinfo request
2018-07-20 00:00:48.421 +07:00 [DBG] Bearer token found in header
2018-07-20 00:00:48.530 +07:00 [DBG] js found in database: true
2018-07-20 00:00:48.542 +07:00 [DBG] js found in database: true
2018-07-20 00:00:48.568 +07:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-07-20 00:00:48.569 +07:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1532019625,
    "exp": 1532023225,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "blue_api"
    ],
    "client_id": "js",
    "sub": "4b33da58-3ce8-4985-81e6-3360508a7011",
    "auth_time": 1532016959,
    "idp": "local",
    "given_name": "Shop",
    "family_name": "Administrator",
    "updated_at": "1532011106",
    "email": "admin@gmail.com",
    "scope": [
      "openid",
      "profile",
      "blue_api"
    ],
    "amr": "pwd"
  }
}
2018-07-20 00:00:48.573 +07:00 [DBG] Creating userinfo response
2018-07-20 00:00:48.573 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-20 00:00:48.573 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-20 00:00:48.618 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-20 00:00:48.619 +07:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture preferred_username nickname middle_name given_name family_name name profile
2018-07-20 00:00:48.619 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-20 00:00:48.633 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-20 00:00:48.733 +07:00 [INF] Profile service returned to the following claim types: sub preferred_username name given_name family_name updated_at email jti iat
2018-07-20 00:00:48.733 +07:00 [DBG] End userinfo request
2018-07-20 00:14:32.000 +07:00 [INF] Clearing 0 tokens
2018-07-20 21:48:20.552 +07:00 [INF] Migrating database associated with context PersistedGrantDbContext
2018-07-20 21:48:25.310 +07:00 [INF] Migrated database associated with context PersistedGrantDbContext
2018-07-20 21:48:25.351 +07:00 [INF] Migrating database associated with context ApplicationDbContext
2018-07-20 21:48:29.204 +07:00 [INF] Migrated database associated with context ApplicationDbContext
2018-07-20 21:48:29.218 +07:00 [INF] Migrating database associated with context ConfigurationDbContext
2018-07-20 21:48:30.145 +07:00 [INF] Migrated database associated with context ConfigurationDbContext
2018-07-20 21:48:32.835 +07:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-20 21:48:32.866 +07:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-20 21:48:32.867 +07:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-20 21:48:32.867 +07:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-20 21:48:32.867 +07:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-20 21:48:35.499 +07:00 [DBG] Starting token cleanup
2018-07-20 21:48:36.479 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-20 21:48:36.577 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-20 21:48:47.622 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-20 21:48:47.624 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-20 22:08:14.537 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-20 22:08:14.565 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-20 22:08:14.609 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-20 22:08:14.775 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-20 22:08:14.777 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-20 22:08:14.796 +07:00 [DBG] Start authorize request
2018-07-20 22:08:14.820 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-20 22:08:14.829 +07:00 [DBG] No user present in authorize request
2018-07-20 22:08:15.134 +07:00 [DBG] Start authorize request protocol validation
2018-07-20 22:08:17.094 +07:00 [DBG] js found in database: true
2018-07-20 22:08:17.266 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-20 22:08:17.809 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-20 22:08:17.862 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-20 22:08:17.869 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-20 22:08:17.890 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-20 22:08:17.950 +07:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "AllowedRedirectUris": [
    "http://localhost:4200/"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile blue_api",
  "State": "15320992943380.47697935247168477",
  "Nonce": "N0.3511768537298111532099294338",
  "Raw": {
    "response_type": "id_token token",
    "client_id": "js",
    "redirect_uri": "http://localhost:4200/",
    "scope": "openid profile blue_api",
    "nonce": "N0.3511768537298111532099294338",
    "state": "15320992943380.47697935247168477"
  }
}
2018-07-20 22:08:17.966 +07:00 [INF] Showing login: User is not authenticated
2018-07-20 22:08:18.021 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-20 22:08:18.021 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-20 22:08:18.192 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-20 22:08:18.193 +07:00 [DBG] Start authorize request protocol validation
2018-07-20 22:08:18.207 +07:00 [DBG] js found in database: true
2018-07-20 22:08:18.210 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-20 22:08:18.216 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-20 22:08:18.218 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-20 22:08:18.225 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-20 22:08:18.225 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-20 22:08:18.238 +07:00 [DBG] js found in database: true
2018-07-20 22:08:30.629 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-20 22:08:30.629 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-20 22:10:36.627 +07:00 [DBG] Augmenting SignInContext
2018-07-20 22:10:36.631 +07:00 [DBG] Adding idp claim with value: local
2018-07-20 22:10:36.631 +07:00 [DBG] Adding amr claim with value: pwd
2018-07-20 22:10:36.632 +07:00 [DBG] Adding auth_time claim with value: 1532099436
2018-07-20 22:10:36.636 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-07-20 22:10:36.656 +07:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-07-20 22:10:36.722 +07:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-07-20 22:10:36.724 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-07-20 22:10:36.724 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-07-20 22:10:36.730 +07:00 [DBG] Start authorize callback request
2018-07-20 22:10:36.740 +07:00 [DBG] User in authorize request: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-20 22:10:36.740 +07:00 [DBG] Start authorize request protocol validation
2018-07-20 22:10:36.767 +07:00 [DBG] js found in database: true
2018-07-20 22:10:36.773 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-20 22:10:36.856 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-20 22:10:36.858 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-20 22:10:36.861 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-20 22:10:36.861 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-20 22:10:36.862 +07:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "AllowedRedirectUris": [
    "http://localhost:4200/"
  ],
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile blue_api",
  "State": "15320992943380.47697935247168477",
  "Nonce": "N0.3511768537298111532099294338",
  "SessionId": "9060a1d08fcecac006b7673610cd5086",
  "Raw": {
    "response_type": "id_token token",
    "client_id": "js",
    "redirect_uri": "http://localhost:4200/",
    "scope": "openid profile blue_api",
    "nonce": "N0.3511768537298111532099294338",
    "state": "15320992943380.47697935247168477"
  }
}
2018-07-20 22:10:36.904 +07:00 [DBG] Client is configured to not require consent, no consent is required
2018-07-20 22:10:36.912 +07:00 [DBG] Creating Implicit Flow response.
2018-07-20 22:10:36.922 +07:00 [DBG] Getting claims for access token for client: js
2018-07-20 22:10:36.923 +07:00 [DBG] Getting claims for access token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-20 22:10:36.945 +07:00 [DBG] Claim types from profile service that were filtered: ["jti","iat"]
2018-07-20 22:10:37.083 +07:00 [DBG] Getting claims for identity token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011 and client: js
2018-07-20 22:10:37.083 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-20 22:10:37.135 +07:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "Endpoint": "Authorize",
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "Scopes": "openid profile blue_api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****UVEg"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****EZTQ"
    }
  ],
  "ActivityId": "0HLFE9VFJEL9P:00000004",
  "TimeStamp": "2018-07-20T15:10:37Z",
  "ProcessId": 5848,
  "LocalIpAddress": "127.0.0.1:13436",
  "RemoteIpAddress": "::1"
}
2018-07-20 22:10:37.142 +07:00 [INF] Authorize endpoint response
{
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ClientId": "js",
  "RedirectUri": "http://localhost:4200/",
  "State": "15320992943380.47697935247168477",
  "Scope": "openid profile blue_api"
}
2018-07-20 22:10:37.162 +07:00 [DBG] Augmenting SignInContext
2018-07-20 22:10:37.163 +07:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-07-20 22:10:40.396 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-20 22:10:40.444 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-20 22:10:40.445 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-20 22:10:40.511 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-20 22:10:40.526 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-20 22:10:40.527 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-20 22:10:40.528 +07:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-07-20 22:10:40.534 +07:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-07-20 22:10:40.534 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-07-20 22:10:40.547 +07:00 [DBG] Start userinfo request
2018-07-20 22:10:40.554 +07:00 [DBG] Bearer token found in header
2018-07-20 22:10:40.763 +07:00 [DBG] js found in database: true
2018-07-20 22:10:40.773 +07:00 [DBG] js found in database: true
2018-07-20 22:10:40.795 +07:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-07-20 22:10:40.804 +07:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1532099436,
    "exp": 1532103036,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "blue_api"
    ],
    "client_id": "js",
    "sub": "4b33da58-3ce8-4985-81e6-3360508a7011",
    "auth_time": 1532099436,
    "idp": "local",
    "given_name": "Shop",
    "family_name": "Administrator",
    "updated_at": "1532011106",
    "email": "admin@gmail.com",
    "scope": [
      "openid",
      "profile",
      "blue_api"
    ],
    "amr": "pwd"
  }
}
2018-07-20 22:10:40.820 +07:00 [DBG] Creating userinfo response
2018-07-20 22:10:40.828 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-20 22:10:40.834 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-20 22:10:40.844 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-20 22:10:40.845 +07:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture preferred_username nickname middle_name given_name family_name name profile
2018-07-20 22:10:40.845 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-20 22:10:40.851 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-20 22:10:40.866 +07:00 [INF] Profile service returned to the following claim types: sub preferred_username name given_name family_name updated_at email jti iat
2018-07-20 22:10:40.867 +07:00 [DBG] End userinfo request
2018-07-20 22:48:36.086 +07:00 [INF] Clearing 0 tokens
2018-07-20 23:48:36.170 +07:00 [INF] Clearing 0 tokens
2018-07-21 00:48:36.279 +07:00 [INF] Clearing 0 tokens
2018-07-21 21:00:37.255 +07:00 [INF] Migrating database associated with context PersistedGrantDbContext
2018-07-21 21:00:39.482 +07:00 [INF] Migrated database associated with context PersistedGrantDbContext
2018-07-21 21:00:39.524 +07:00 [INF] Migrating database associated with context ApplicationDbContext
2018-07-21 21:00:40.963 +07:00 [INF] Migrated database associated with context ApplicationDbContext
2018-07-21 21:00:40.968 +07:00 [INF] Migrating database associated with context ConfigurationDbContext
2018-07-21 21:00:41.279 +07:00 [INF] Migrated database associated with context ConfigurationDbContext
2018-07-21 21:00:41.933 +07:00 [DBG] Using Identity.Application as default scheme for authentication
2018-07-21 21:00:41.939 +07:00 [DBG] Using Identity.External as default scheme for sign-in
2018-07-21 21:00:41.939 +07:00 [DBG] Using Identity.External as default scheme for sign-out
2018-07-21 21:00:41.939 +07:00 [DBG] Using Identity.Application as default scheme for challenge
2018-07-21 21:00:41.939 +07:00 [DBG] Using Identity.Application as default scheme for forbid
2018-07-21 21:00:42.597 +07:00 [DBG] Starting token cleanup
2018-07-21 21:03:47.104 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-21 21:03:47.163 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-21 21:03:47.165 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-21 21:03:47.187 +07:00 [DBG] Start authorize request
2018-07-21 21:03:47.227 +07:00 [DBG] User in authorize request: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-21 21:03:49.792 +07:00 [DBG] Start authorize request protocol validation
2018-07-21 21:03:50.483 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-07-21 21:03:50.484 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-07-21 21:03:50.485 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-07-21 21:03:50.485 +07:00 [DBG] Start authorize request
2018-07-21 21:03:50.485 +07:00 [DBG] User in authorize request: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-21 21:03:50.485 +07:00 [DBG] Start authorize request protocol validation
2018-07-21 21:03:51.553 +07:00 [DBG] js found in database: true
2018-07-21 21:03:51.553 +07:00 [DBG] js found in database: true
2018-07-21 21:03:51.660 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-21 21:03:51.660 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-21 21:03:52.203 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-21 21:03:52.203 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-21 21:03:52.231 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-21 21:03:52.231 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-21 21:03:52.348 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-21 21:03:52.363 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-21 21:03:52.387 +07:00 [DBG] Found ["roles","blue_api"] API scopes in database
2018-07-21 21:03:52.387 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-07-21 21:03:52.428 +07:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "AllowedRedirectUris": [
    "http://localhost:4200/"
  ],
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile blue_api",
  "State": "15321818304530.7438565875620478",
  "Nonce": "N0.2922272329768011532181830453",
  "SessionId": "9060a1d08fcecac006b7673610cd5086",
  "Raw": {
    "response_type": "id_token token",
    "client_id": "js",
    "redirect_uri": "http://localhost:4200/",
    "scope": "openid profile blue_api",
    "nonce": "N0.2922272329768011532181830453",
    "state": "15321818304530.7438565875620478"
  }
}
2018-07-21 21:03:52.429 +07:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "AllowedRedirectUris": [
    "http://localhost:4200/"
  ],
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile blue_api",
  "State": "15321818268830.8716952621038785",
  "Nonce": "N0.086471431362378231532181826883",
  "SessionId": "9060a1d08fcecac006b7673610cd5086",
  "Raw": {
    "response_type": "id_token token",
    "client_id": "js",
    "redirect_uri": "http://localhost:4200/",
    "scope": "openid profile blue_api",
    "nonce": "N0.086471431362378231532181826883",
    "state": "15321818268830.8716952621038785"
  }
}
2018-07-21 21:03:52.534 +07:00 [DBG] Client is configured to not require consent, no consent is required
2018-07-21 21:03:52.534 +07:00 [DBG] Client is configured to not require consent, no consent is required
2018-07-21 21:03:52.542 +07:00 [DBG] Creating Implicit Flow response.
2018-07-21 21:03:52.542 +07:00 [DBG] Creating Implicit Flow response.
2018-07-21 21:03:52.560 +07:00 [DBG] Getting claims for access token for client: js
2018-07-21 21:03:52.560 +07:00 [DBG] Getting claims for access token for client: js
2018-07-21 21:03:52.561 +07:00 [DBG] Getting claims for access token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-21 21:03:52.561 +07:00 [DBG] Getting claims for access token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011
2018-07-21 21:03:52.619 +07:00 [DBG] Claim types from profile service that were filtered: ["jti","iat"]
2018-07-21 21:03:52.619 +07:00 [DBG] Claim types from profile service that were filtered: ["jti","iat"]
2018-07-21 21:03:52.763 +07:00 [DBG] Getting claims for identity token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011 and client: js
2018-07-21 21:03:52.763 +07:00 [DBG] Getting claims for identity token for subject: 4b33da58-3ce8-4985-81e6-3360508a7011 and client: js
2018-07-21 21:03:52.763 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-21 21:03:52.763 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-07-21 21:03:52.819 +07:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "Endpoint": "Authorize",
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "Scopes": "openid profile blue_api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****aWdw"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****z8aA"
    }
  ],
  "ActivityId": "0HLFF29CJ8G39:00000001",
  "TimeStamp": "2018-07-21T14:03:52Z",
  "ProcessId": 1584,
  "LocalIpAddress": "127.0.0.1:16463",
  "RemoteIpAddress": "::1"
}
2018-07-21 21:03:52.822 +07:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "js",
  "ClientName": "eShop SPA OpenId Client",
  "RedirectUri": "http://localhost:4200/",
  "Endpoint": "Authorize",
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "Scopes": "openid profile blue_api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****o0OQ"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****z8aA"
    }
  ],
  "ActivityId": "0HLFF29CJ8G38:00000001",
  "TimeStamp": "2018-07-21T14:03:52Z",
  "ProcessId": 1584,
  "LocalIpAddress": "127.0.0.1:16463",
  "RemoteIpAddress": "::1"
}
2018-07-21 21:03:52.825 +07:00 [INF] Authorize endpoint response
{
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ClientId": "js",
  "RedirectUri": "http://localhost:4200/",
  "State": "15321818304530.7438565875620478",
  "Scope": "openid profile blue_api"
}
2018-07-21 21:03:52.825 +07:00 [INF] Authorize endpoint response
{
  "SubjectId": "4b33da58-3ce8-4985-81e6-3360508a7011",
  "ClientId": "js",
  "RedirectUri": "http://localhost:4200/",
  "State": "15321818268830.8716952621038785",
  "Scope": "openid profile blue_api"
}
2018-07-21 21:03:55.587 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-21 21:03:55.681 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-21 21:03:55.681 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-21 21:03:55.962 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-07-21 21:03:55.977 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-07-21 21:03:55.977 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-07-21 21:03:56.002 +07:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-07-21 21:03:56.007 +07:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-07-21 21:03:56.007 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-07-21 21:03:56.018 +07:00 [DBG] Start userinfo request
2018-07-21 21:03:56.028 +07:00 [DBG] Bearer token found in header
2018-07-21 21:03:56.449 +07:00 [DBG] js found in database: true
2018-07-21 21:03:56.562 +07:00 [DBG] js found in database: true
2018-07-21 21:03:56.911 +07:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-07-21 21:03:56.917 +07:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1532181832,
    "exp": 1532185432,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "blue_api"
    ],
    "client_id": "js",
    "sub": "4b33da58-3ce8-4985-81e6-3360508a7011",
    "auth_time": 1532099436,
    "idp": "local",
    "given_name": "Shop",
    "family_name": "Administrator",
    "updated_at": "1532011106",
    "email": "admin@gmail.com",
    "scope": [
      "openid",
      "profile",
      "blue_api"
    ],
    "amr": "pwd"
  }
}
2018-07-21 21:03:56.932 +07:00 [DBG] Creating userinfo response
2018-07-21 21:03:56.936 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-21 21:03:56.940 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-21 21:03:56.961 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-21 21:03:56.962 +07:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture preferred_username nickname middle_name given_name family_name name profile
2018-07-21 21:03:56.962 +07:00 [DBG] Scopes in access token: openid profile blue_api
2018-07-21 21:03:56.970 +07:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-07-21 21:03:57.025 +07:00 [INF] Profile service returned to the following claim types: sub preferred_username name given_name family_name updated_at email jti iat
2018-07-21 21:03:57.026 +07:00 [DBG] End userinfo request
